<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://x.app/posts/db/ulimit.html"><meta property="og:site_name" content="doc"><meta property="og:title" content="MySQL5.7在compose部署时内存异常Bug"><meta property="og:description" content="Bug 描述 在使用 Docker Compose（version v2.35.1） 部署 MySQL 5.7 时，发现我16G的内存几乎被耗尽，通过 docker stats命令查看，发现MySQL5.7对应的容器占用了几乎所有的内存。 尝试通过 docker run 来部署结果也一样 (docker version: 28.1.1) 不死心的我于是..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2025-05-22T04:01:46.000Z"><meta property="article:author" content="ventixy"><meta property="article:tag" content="Database"><meta property="article:tag" content="MySQL"><meta property="article:tag" content="ulimit"><meta property="article:published_time" content="2025-05-20T00:00:00.000Z"><meta property="article:modified_time" content="2025-05-22T04:01:46.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MySQL5.7在compose部署时内存异常Bug","image":[""],"datePublished":"2025-05-20T00:00:00.000Z","dateModified":"2025-05-22T04:01:46.000Z","author":[{"@type":"Person","name":"ventixy","url":"https://www.ventix.top"}]}</script><link rel="icon" href="/jav.ico"><title>MySQL5.7在compose部署时内存异常Bug | doc</title><meta name="description" content="Bug 描述 在使用 Docker Compose（version v2.35.1） 部署 MySQL 5.7 时，发现我16G的内存几乎被耗尽，通过 docker stats命令查看，发现MySQL5.7对应的容器占用了几乎所有的内存。 尝试通过 docker run 来部署结果也一样 (docker version: 28.1.1) 不死心的我于是...">
    <link rel="preload" href="/assets/style-B_XoRuKw.css" as="style"><link rel="stylesheet" href="/assets/style-B_XoRuKw.css">
    <link rel="modulepreload" href="/assets/app-BZ6c0yG4.js"><link rel="modulepreload" href="/assets/ulimit.html-D8Gpb3Ot.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-DyLeqCc4.js" as="script"><link rel="prefetch" href="/assets/blog.html-BXq0Ct9t.js" as="script"><link rel="prefetch" href="/assets/intro.html-h7xWe0eD.js" as="script"><link rel="prefetch" href="/assets/index.html-zCiq0M6Z.js" as="script"><link rel="prefetch" href="/assets/dev.html-Zu7bKI_t.js" as="script"><link rel="prefetch" href="/assets/lang.html-B4G05CN_.js" as="script"><link rel="prefetch" href="/assets/mcp.html-CAzSr5Cl.js" as="script"><link rel="prefetch" href="/assets/program.html-Ckr8FW15.js" as="script"><link rel="prefetch" href="/assets/prompt.html-CJ6T6oCX.js" as="script"><link rel="prefetch" href="/assets/rag.html-4YkXCNOT.js" as="script"><link rel="prefetch" href="/assets/springai.html-CDNT3Isv.js" as="script"><link rel="prefetch" href="/assets/index.html-BPRooMoJ.js" as="script"><link rel="prefetch" href="/assets/index.html-WJOaJicN.js" as="script"><link rel="prefetch" href="/assets/index.html-DwpPeijz.js" as="script"><link rel="prefetch" href="/assets/index.html-B-FHGJze.js" as="script"><link rel="prefetch" href="/assets/Gradle.html-DYC-QRv-.js" as="script"><link rel="prefetch" href="/assets/index.html-BNC534Mc.js" as="script"><link rel="prefetch" href="/assets/maven.html-C63Rkrnl.js" as="script"><link rel="prefetch" href="/assets/theme.html-DO9wvd5X.js" as="script"><link rel="prefetch" href="/assets/index.html-Dl4SeoeS.js" as="script"><link rel="prefetch" href="/assets/index.html-Ca9UeLPA.js" as="script"><link rel="prefetch" href="/assets/index.html-CCD-mPhh.js" as="script"><link rel="prefetch" href="/assets/c.html-DH2DDQrL.js" as="script"><link rel="prefetch" href="/assets/c2.html-BWpmGMI6.js" as="script"><link rel="prefetch" href="/assets/core.html-HmJH94rt.js" as="script"><link rel="prefetch" href="/assets/index.html-CqzGZNDm.js" as="script"><link rel="prefetch" href="/assets/Annotation.html-BRyB6fWV.js" as="script"><link rel="prefetch" href="/assets/Enum.html-QBeSecUq.js" as="script"><link rel="prefetch" href="/assets/HashMap.html-C6YazYv9.js" as="script"><link rel="prefetch" href="/assets/Java基础.html-C2m2qFUn.js" as="script"><link rel="prefetch" href="/assets/Java常用类库.html-BpHQBpOJ.js" as="script"><link rel="prefetch" href="/assets/Java面向对象.html-HvB9IClR.js" as="script"><link rel="prefetch" href="/assets/Lambda.html-C9Jh-GB4.js" as="script"><link rel="prefetch" href="/assets/index.html-BreYqPPt.js" as="script"><link rel="prefetch" href="/assets/Reflection.html-DwfhuzrW.js" as="script"><link rel="prefetch" href="/assets/Stream.html-D6_gNcqQ.js" as="script"><link rel="prefetch" href="/assets/collection.html-f43A4qDm.js" as="script"><link rel="prefetch" href="/assets/generics.html-D1YTTQLc.js" as="script"><link rel="prefetch" href="/assets/javaIO.html-Ci6diTLO.js" as="script"><link rel="prefetch" href="/assets/set和map.html-4BGRQYf1.js" as="script"><link rel="prefetch" href="/assets/数组和字符串.html-DJYOn6Vf.js" as="script"><link rel="prefetch" href="/assets/index.html-BbLNIJTT.js" as="script"><link rel="prefetch" href="/assets/index.html-CstwAMf8.js" as="script"><link rel="prefetch" href="/assets/index.html-DCyXrKcj.js" as="script"><link rel="prefetch" href="/assets/index.html-BAKUMn7I.js" as="script"><link rel="prefetch" href="/assets/index.html-DXiXhTzP.js" as="script"><link rel="prefetch" href="/assets/index.html-tDUx71Af.js" as="script"><link rel="prefetch" href="/assets/idea.html-BkaHb0me.js" as="script"><link rel="prefetch" href="/assets/mac.html-BRykwvRU.js" as="script"><link rel="prefetch" href="/assets/nuc8.html-Cn1tihzb.js" as="script"><link rel="prefetch" href="/assets/picgo.html-DLc4S0jK.js" as="script"><link rel="prefetch" href="/assets/usual.html-DiqsyrxG.js" as="script"><link rel="prefetch" href="/assets/vps.html-Cx2iGpHh.js" as="script"><link rel="prefetch" href="/assets/website.html-C496R7F2.js" as="script"><link rel="prefetch" href="/assets/windows.html-CIIHtbOa.js" as="script"><link rel="prefetch" href="/assets/index.html-D7RoMkzA.js" as="script"><link rel="prefetch" href="/assets/encoding.html-COIU7cM6.js" as="script"><link rel="prefetch" href="/assets/harddisk.html-C14Symr3.js" as="script"><link rel="prefetch" href="/assets/index.html-yJSJ-bDs.js" as="script"><link rel="prefetch" href="/assets/mysql-binlog.html-RiAUnTZJ.js" as="script"><link rel="prefetch" href="/assets/mysql-lock.html-4uJZUX75.js" as="script"><link rel="prefetch" href="/assets/mysql.html-DwLTmG2h.js" as="script"><link rel="prefetch" href="/assets/postgres.html-D6zikJ3N.js" as="script"><link rel="prefetch" href="/assets/index.html-Cb0jzWfF.js" as="script"><link rel="prefetch" href="/assets/env.html-Cff5esiD.js" as="script"><link rel="prefetch" href="/assets/history.html-KXvzk0SM.js" as="script"><link rel="prefetch" href="/assets/jar.html-D82l9JAJ.js" as="script"><link rel="prefetch" href="/assets/kryo.html-D793aZaS.js" as="script"><link rel="prefetch" href="/assets/index.html-xne3IPs5.js" as="script"><link rel="prefetch" href="/assets/k8s.html-e_7kYM7u.js" as="script"><link rel="prefetch" href="/assets/ks-install.html-CJCtWux5.js" as="script"><link rel="prefetch" href="/assets/vm.html-CsxhyRPF.js" as="script"><link rel="prefetch" href="/assets/index.html-DfEWV8oG.js" as="script"><link rel="prefetch" href="/assets/crossDomain.html-RpjOKF9C.js" as="script"><link rel="prefetch" href="/assets/excel.html-4pSLLlpO.js" as="script"><link rel="prefetch" href="/assets/springboot.html-CehDYDQB.js" as="script"><link rel="prefetch" href="/assets/index.html-pmD4Kp6h.js" as="script"><link rel="prefetch" href="/assets/index.html-Bv55eRQX.js" as="script"><link rel="prefetch" href="/assets/PICO.html-CWUcVrCx.js" as="script"><link rel="prefetch" href="/assets/index.html-B6wLMLpA.js" as="script"><link rel="prefetch" href="/assets/ch9329.html-CYj90qpO.js" as="script"><link rel="prefetch" href="/assets/damb.html-C55nYSQy.js" as="script"><link rel="prefetch" href="/assets/hid.html-B5NSCsUL.js" as="script"><link rel="prefetch" href="/assets/index.html-8ZnKkVY7.js" as="script"><link rel="prefetch" href="/assets/base.html-Btz8kdAn.js" as="script"><link rel="prefetch" href="/assets/data.html-B1pumEcJ.js" as="script"><link rel="prefetch" href="/assets/file.html-f4TT4uay.js" as="script"><link rel="prefetch" href="/assets/function.html-CpHJEWb8.js" as="script"><link rel="prefetch" href="/assets/oop.html--Zqf6NzJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DnaobLXv.js" as="script"><link rel="prefetch" href="/assets/pywin32.html-Bam8OPWg.js" as="script"><link rel="prefetch" href="/assets/yolo.html-X0Wo9bVO.js" as="script"><link rel="prefetch" href="/assets/index.html-D-gDwhSx.js" as="script"><link rel="prefetch" href="/assets/base.html-kJMjsbT9.js" as="script"><link rel="prefetch" href="/assets/numpy.html-CpJGSTsm.js" as="script"><link rel="prefetch" href="/assets/opencv.html-DLJ7gtwb.js" as="script"><link rel="prefetch" href="/assets/pillow.html-Dr8uRLeb.js" as="script"><link rel="prefetch" href="/assets/python.html-DfDi-9HR.js" as="script"><link rel="prefetch" href="/assets/sd.html-J3DVNsgy.js" as="script"><link rel="prefetch" href="/assets/index.html-DNS0LJs4.js" as="script"><link rel="prefetch" href="/assets/application.html-6Y2kwCf7.js" as="script"><link rel="prefetch" href="/assets/call.html-BjZaZjmx.js" as="script"><link rel="prefetch" href="/assets/http.html-CCmh9O1d.js" as="script"><link rel="prefetch" href="/assets/interface.html-Dld6laNx.js" as="script"><link rel="prefetch" href="/assets/io.html-dPYErFVs.js" as="script"><link rel="prefetch" href="/assets/memory.html-BOnyZrJ1.js" as="script"><link rel="prefetch" href="/assets/network.html-Cuj6P9na.js" as="script"><link rel="prefetch" href="/assets/os.html-B-XaIypH.js" as="script"><link rel="prefetch" href="/assets/process.html-NxQVGg8p.js" as="script"><link rel="prefetch" href="/assets/transport.html-DQhV-veR.js" as="script"><link rel="prefetch" href="/assets/index.html-Cb0vKdo0.js" as="script"><link rel="prefetch" href="/assets/index.html-CgGYnlSr.js" as="script"><link rel="prefetch" href="/assets/Linux.html-ByVe7Nr-.js" as="script"><link rel="prefetch" href="/assets/index.html-8Qg5W3jY.js" as="script"><link rel="prefetch" href="/assets/file.html-DIOCUd83.js" as="script"><link rel="prefetch" href="/assets/setting.html-BJonELD9.js" as="script"><link rel="prefetch" href="/assets/shell.html-mGg8WgsB.js" as="script"><link rel="prefetch" href="/assets/Docker.html-BoReI_QW.js" as="script"><link rel="prefetch" href="/assets/index.html-CECNVAMm.js" as="script"><link rel="prefetch" href="/assets/install.html-vFmZgxMc.js" as="script"><link rel="prefetch" href="/assets/k8s.html-BT1bfKSe.js" as="script"><link rel="prefetch" href="/assets/index.html-BXiuqwSi.js" as="script"><link rel="prefetch" href="/assets/git.html-BgkGCWh0.js" as="script"><link rel="prefetch" href="/assets/git1.html-KjGO-qLF.js" as="script"><link rel="prefetch" href="/assets/jenkins.html-DKAixUJ9.js" as="script"><link rel="prefetch" href="/assets/index.html-BuwsExmi.js" as="script"><link rel="prefetch" href="/assets/index.html-oFMwufV6.js" as="script"><link rel="prefetch" href="/assets/index.html-BgmwYAEG.js" as="script"><link rel="prefetch" href="/assets/index.html-Bg_sNbUZ.js" as="script"><link rel="prefetch" href="/assets/index.html-CYFLwtA_.js" as="script"><link rel="prefetch" href="/assets/netty.html-BrLpkD9w.js" as="script"><link rel="prefetch" href="/assets/nio.html-CxH594HN.js" as="script"><link rel="prefetch" href="/assets/socket.html-CmAlMc3x.js" as="script"><link rel="prefetch" href="/assets/theory.html-CcqVoeTG.js" as="script"><link rel="prefetch" href="/assets/Jvm内存管理.html-DXBkKptB.js" as="script"><link rel="prefetch" href="/assets/Jvm类加载.html-ZHGmYvlT.js" as="script"><link rel="prefetch" href="/assets/index.html-CCcsLL7D.js" as="script"><link rel="prefetch" href="/assets/bytecode.html-C-4i40mE.js" as="script"><link rel="prefetch" href="/assets/pt.html-BnDqOhZF.js" as="script"><link rel="prefetch" href="/assets/index.html-9LWFDm3j.js" as="script"><link rel="prefetch" href="/assets/lock.html-DIroXzYO.js" as="script"><link rel="prefetch" href="/assets/pool.html-jEDddYxv.js" as="script"><link rel="prefetch" href="/assets/thread.html-C4zRQH0l.js" as="script"><link rel="prefetch" href="/assets/tool.html-CGL57UqW.js" as="script"><link rel="prefetch" href="/assets/Architecture.html-Bxyqb9Of.js" as="script"><link rel="prefetch" href="/assets/index.html-DIhfcZyf.js" as="script"><link rel="prefetch" href="/assets/Transaction.html-DSrwBC3-.js" as="script"><link rel="prefetch" href="/assets/mysql-index.html-GeRTrfPe.js" as="script"><link rel="prefetch" href="/assets/redis-java.html-U6a0YcZi.js" as="script"><link rel="prefetch" href="/assets/redis.html-BGv2k6Vv.js" as="script"><link rel="prefetch" href="/assets/sql.html-D2Pna4iz.js" as="script"><link rel="prefetch" href="/assets/Hibernate.html-CqvxgXRR.js" as="script"><link rel="prefetch" href="/assets/index.html-Cx5c36nk.js" as="script"><link rel="prefetch" href="/assets/generator.html-Ds0vC1O7.js" as="script"><link rel="prefetch" href="/assets/mybatis-resource.html-Dn6T312X.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-CAU4MrFA.js" as="script"><link rel="prefetch" href="/assets/tk-mybatis.html-DPkT-9an.js" as="script"><link rel="prefetch" href="/assets/index.html-Ghf9_imB.js" as="script"><link rel="prefetch" href="/assets/Servlet.html-FMc0wE6Q.js" as="script"><link rel="prefetch" href="/assets/jsp.html-5J33WQ8E.js" as="script"><link rel="prefetch" href="/assets/mvc.html-CZWWAWC8.js" as="script"><link rel="prefetch" href="/assets/nginx.html-4wHBURK6.js" as="script"><link rel="prefetch" href="/assets/tomcat.html-BxSsA0q-.js" as="script"><link rel="prefetch" href="/assets/index.html-CJjx-MRl.js" as="script"><link rel="prefetch" href="/assets/log.html-D2cFaARa.js" as="script"><link rel="prefetch" href="/assets/shiro.html-4__GY9xI.js" as="script"><link rel="prefetch" href="/assets/index.html-Cla8s-gj.js" as="script"><link rel="prefetch" href="/assets/design.html-23bGgJxF.js" as="script"><link rel="prefetch" href="/assets/life.html-CQCwMDz8.js" as="script"><link rel="prefetch" href="/assets/mvc-core.html-ZbDm5ypL.js" as="script"><link rel="prefetch" href="/assets/sb-core.html-B3yCz0Dn.js" as="script"><link rel="prefetch" href="/assets/sec.html-czDqlQ1k.js" as="script"><link rel="prefetch" href="/assets/spring.html-DmKA7V-6.js" as="script"><link rel="prefetch" href="/assets/springboot.html-BtwueT4u.js" as="script"><link rel="prefetch" href="/assets/springmvc.html-4RvU106c.js" as="script"><link rel="prefetch" href="/assets/transaction.html-But-xqJX.js" as="script"><link rel="prefetch" href="/assets/index.html-Ceu2nPQl.js" as="script"><link rel="prefetch" href="/assets/mybatis.html-BgIQXfyj.js" as="script"><link rel="prefetch" href="/assets/mysql.html-BeOgzDw5.js" as="script"><link rel="prefetch" href="/assets/redis.html-ChLsIgGK.js" as="script"><link rel="prefetch" href="/assets/security.html-Cig0ph-C.js" as="script"><link rel="prefetch" href="/assets/spring.html-Cv5rfKb1.js" as="script"><link rel="prefetch" href="/assets/springboot.html-zxPXCFf-.js" as="script"><link rel="prefetch" href="/assets/index.html-BA7f4qCU.js" as="script"><link rel="prefetch" href="/assets/base.html-D5J4qYbv.js" as="script"><link rel="prefetch" href="/assets/collect.html-Bf8E0mZR.js" as="script"><link rel="prefetch" href="/assets/concurrency.html-CCVjXmI2.js" as="script"><link rel="prefetch" href="/assets/jvm.html-9zbG80cK.js" as="script"><link rel="prefetch" href="/assets/index.html-CCupxzh4.js" as="script"><link rel="prefetch" href="/assets/es.html-cFCIETgw.js" as="script"><link rel="prefetch" href="/assets/rocketmq.html-CrCzmcro.js" as="script"><link rel="prefetch" href="/assets/sys.html-CiRJ2rwl.js" as="script"><link rel="prefetch" href="/assets/index.html-B3eJS8mm.js" as="script"><link rel="prefetch" href="/assets/RabbitMQ.html-CtuLZK3K.js" as="script"><link rel="prefetch" href="/assets/RockMQ.html-Ct6cBOeE.js" as="script"><link rel="prefetch" href="/assets/Sentinel.html-BMv4AV6R.js" as="script"><link rel="prefetch" href="/assets/dubbo.html-DLIMSHaO.js" as="script"><link rel="prefetch" href="/assets/es.html-eZGniYKM.js" as="script"><link rel="prefetch" href="/assets/eureka.html-CyPStsan.js" as="script"><link rel="prefetch" href="/assets/gateway.html-DAgItF1a.js" as="script"><link rel="prefetch" href="/assets/hystrix.html-CFTwCzQ8.js" as="script"><link rel="prefetch" href="/assets/kafka.html-Dg8PJH2L.js" as="script"><link rel="prefetch" href="/assets/nacos.html-BEMFkeIS.js" as="script"><link rel="prefetch" href="/assets/zookeeper.html-Bj5tIbuJ.js" as="script"><link rel="prefetch" href="/assets/index.html-DpAMScas.js" as="script"><link rel="prefetch" href="/assets/cron.html-CcsqnqtU.js" as="script"><link rel="prefetch" href="/assets/db.html--iIxlq4p.js" as="script"><link rel="prefetch" href="/assets/dup.html-DQA5925d.js" as="script"><link rel="prefetch" href="/assets/lock.html-BFMFGkb6.js" as="script"><link rel="prefetch" href="/assets/redis.html-ChWaJjRW.js" as="script"><link rel="prefetch" href="/assets/transac.html-Bc7nTgq8.js" as="script"><link rel="prefetch" href="/assets/walk.html-CBEjP-Tu.js" as="script"><link rel="prefetch" href="/assets/index.html-D8EDfg-v.js" as="script"><link rel="prefetch" href="/assets/numpy.html-RV6Qgk-E.js" as="script"><link rel="prefetch" href="/assets/pandas.html-BrFKxDhR.js" as="script"><link rel="prefetch" href="/assets/index.html-Cx5cutg8.js" as="script"><link rel="prefetch" href="/assets/css.html-CGXJpUy6.js" as="script"><link rel="prefetch" href="/assets/css2.html-BheprE0q.js" as="script"><link rel="prefetch" href="/assets/css3.html-DP9S1Cqs.js" as="script"><link rel="prefetch" href="/assets/css4.html-BdYbVFof.js" as="script"><link rel="prefetch" href="/assets/html.html-DMtfB9GH.js" as="script"><link rel="prefetch" href="/assets/html5.html-gTFzlETz.js" as="script"><link rel="prefetch" href="/assets/index.html-B_JYjpgW.js" as="script"><link rel="prefetch" href="/assets/dom.html-DL38_5v-.js" as="script"><link rel="prefetch" href="/assets/es6.html-BDxN_QU5.js" as="script"><link rel="prefetch" href="/assets/js.html-j8UvDtZ1.js" as="script"><link rel="prefetch" href="/assets/js2.html-CtHkG68n.js" as="script"><link rel="prefetch" href="/assets/index.html-BhcSbY8x.js" as="script"><link rel="prefetch" href="/assets/ts.html-BJtq36XA.js" as="script"><link rel="prefetch" href="/assets/ts2.html-t0vSOYDv.js" as="script"><link rel="prefetch" href="/assets/index.html-Dglj0vaC.js" as="script"><link rel="prefetch" href="/assets/react.html-KziDb9lC.js" as="script"><link rel="prefetch" href="/assets/ui.html-BJ4mj9OU.js" as="script"><link rel="prefetch" href="/assets/vue.html-BarCWcKo.js" as="script"><link rel="prefetch" href="/assets/index.html-CAO9d7hk.js" as="script"><link rel="prefetch" href="/assets/backend.html-BphNY6TB.js" as="script"><link rel="prefetch" href="/assets/nestjs.html-CQxhKJ0b.js" as="script"><link rel="prefetch" href="/assets/index.html-CbQGcLZa.js" as="script"><link rel="prefetch" href="/assets/build.html-0x6_8u-5.js" as="script"><link rel="prefetch" href="/assets/format.html-C5AU-QHH.js" as="script"><link rel="prefetch" href="/assets/node.html-CrRR-izc.js" as="script"><link rel="prefetch" href="/assets/index.html-DFUYiS82.js" as="script"><link rel="prefetch" href="/assets/index.html-DK8qHziN.js" as="script"><link rel="prefetch" href="/assets/index.html-D5B2cVXv.js" as="script"><link rel="prefetch" href="/assets/baz.html-D-678BCu.js" as="script"><link rel="prefetch" href="/assets/index.html-BkL-jWsp.js" as="script"><link rel="prefetch" href="/assets/ray.html-Dei82hQq.js" as="script"><link rel="prefetch" href="/assets/404.html-BUufwej-.js" as="script"><link rel="prefetch" href="/assets/index.html-Bfb6Z3S5.js" as="script"><link rel="prefetch" href="/assets/index.html-DOyJ9HuH.js" as="script"><link rel="prefetch" href="/assets/index.html-Dxikp3P8.js" as="script"><link rel="prefetch" href="/assets/index.html-DL66kZne.js" as="script"><link rel="prefetch" href="/assets/index.html-DBXWuMVr.js" as="script"><link rel="prefetch" href="/assets/index.html-DvISnF9J.js" as="script"><link rel="prefetch" href="/assets/index.html-CjGJVZBl.js" as="script"><link rel="prefetch" href="/assets/index.html-CaRqFbTR.js" as="script"><link rel="prefetch" href="/assets/index.html-l9sst-g4.js" as="script"><link rel="prefetch" href="/assets/index.html-B8MhMSI1.js" as="script"><link rel="prefetch" href="/assets/index.html-B84JSliM.js" as="script"><link rel="prefetch" href="/assets/index.html-DHQfRonX.js" as="script"><link rel="prefetch" href="/assets/index.html-CVn5qKbo.js" as="script"><link rel="prefetch" href="/assets/index.html-D8dkQvV1.js" as="script"><link rel="prefetch" href="/assets/index.html-D_5mKAyS.js" as="script"><link rel="prefetch" href="/assets/index.html-C-wVIP_G.js" as="script"><link rel="prefetch" href="/assets/index.html-BI49aSQh.js" as="script"><link rel="prefetch" href="/assets/index.html-BHe9zqD_.js" as="script"><link rel="prefetch" href="/assets/index.html-Dyozd5eT.js" as="script"><link rel="prefetch" href="/assets/index.html-TDUNqqFi.js" as="script"><link rel="prefetch" href="/assets/index.html-BOQCbIDv.js" as="script"><link rel="prefetch" href="/assets/index.html-DPU1H2SX.js" as="script"><link rel="prefetch" href="/assets/index.html-B3epzDVd.js" as="script"><link rel="prefetch" href="/assets/index.html-DcIzCaGl.js" as="script"><link rel="prefetch" href="/assets/index.html-CNWJ17Lc.js" as="script"><link rel="prefetch" href="/assets/index.html-DehO_tmx.js" as="script"><link rel="prefetch" href="/assets/index.html-CyOZ6Mfy.js" as="script"><link rel="prefetch" href="/assets/index.html-C6-KY5Xt.js" as="script"><link rel="prefetch" href="/assets/index.html-BAO1kqV-.js" as="script"><link rel="prefetch" href="/assets/index.html-Bd4VFiAa.js" as="script"><link rel="prefetch" href="/assets/index.html-Dyck2oxl.js" as="script"><link rel="prefetch" href="/assets/index.html-BwmSgI3o.js" as="script"><link rel="prefetch" href="/assets/index.html-BdEEvEbT.js" as="script"><link rel="prefetch" href="/assets/index.html-CyEzwJuV.js" as="script"><link rel="prefetch" href="/assets/index.html-Cxlv-Nr3.js" as="script"><link rel="prefetch" href="/assets/index.html-COi0K_1_.js" as="script"><link rel="prefetch" href="/assets/index.html-DYr7ymAc.js" as="script"><link rel="prefetch" href="/assets/index.html-Dhn-OMCp.js" as="script"><link rel="prefetch" href="/assets/index.html-BDniISrw.js" as="script"><link rel="prefetch" href="/assets/index.html-kAQTuJrm.js" as="script"><link rel="prefetch" href="/assets/index.html-Bp93-iAn.js" as="script"><link rel="prefetch" href="/assets/index.html-Dy2Fil0X.js" as="script"><link rel="prefetch" href="/assets/index.html-CreAI7EK.js" as="script"><link rel="prefetch" href="/assets/index.html-35OOam0k.js" as="script"><link rel="prefetch" href="/assets/index.html-pMJ6HS_1.js" as="script"><link rel="prefetch" href="/assets/index.html-DdTo7NRi.js" as="script"><link rel="prefetch" href="/assets/index.html-DGoNj721.js" as="script"><link rel="prefetch" href="/assets/index.html-CQBBrqTz.js" as="script"><link rel="prefetch" href="/assets/index.html-DzRbtZIz.js" as="script"><link rel="prefetch" href="/assets/index.html-DLlEaN1G.js" as="script"><link rel="prefetch" href="/assets/index.html-CYJ9YxV9.js" as="script"><link rel="prefetch" href="/assets/index.html-D7ZacXS3.js" as="script"><link rel="prefetch" href="/assets/index.html-C1mmBweF.js" as="script"><link rel="prefetch" href="/assets/index.html-BFVAeFwF.js" as="script"><link rel="prefetch" href="/assets/index.html-BQM056WW.js" as="script"><link rel="prefetch" href="/assets/index.html-CEhITYr6.js" as="script"><link rel="prefetch" href="/assets/index.html-C9Ws7MTo.js" as="script"><link rel="prefetch" href="/assets/index.html-Qp6rG969.js" as="script"><link rel="prefetch" href="/assets/index.html-DyeiakGJ.js" as="script"><link rel="prefetch" href="/assets/index.html-D4P52tsQ.js" as="script"><link rel="prefetch" href="/assets/index.html-Crsjdhw_.js" as="script"><link rel="prefetch" href="/assets/index.html-DjHOC2PD.js" as="script"><link rel="prefetch" href="/assets/index.html-DsmIGIqO.js" as="script"><link rel="prefetch" href="/assets/index.html-DJvLawuR.js" as="script"><link rel="prefetch" href="/assets/index.html-NlEykg_B.js" as="script"><link rel="prefetch" href="/assets/index.html-DLD_N9Bx.js" as="script"><link rel="prefetch" href="/assets/index.html-Ofi2uzAN.js" as="script"><link rel="prefetch" href="/assets/index.html-x_rApU1s.js" as="script"><link rel="prefetch" href="/assets/index.html-BKp1ZzIU.js" as="script"><link rel="prefetch" href="/assets/index.html-Ba2tzbiU.js" as="script"><link rel="prefetch" href="/assets/index.html-8GCEEv46.js" as="script"><link rel="prefetch" href="/assets/index.html-B2W2Pc1C.js" as="script"><link rel="prefetch" href="/assets/index.html-Cj01qGyu.js" as="script"><link rel="prefetch" href="/assets/index.html-DIOB7_R-.js" as="script"><link rel="prefetch" href="/assets/index.html-Cet_N8bj.js" as="script"><link rel="prefetch" href="/assets/index.html-36z5fSdE.js" as="script"><link rel="prefetch" href="/assets/index.html-BmoYwU0G.js" as="script"><link rel="prefetch" href="/assets/index.html-Bgi020PP.js" as="script"><link rel="prefetch" href="/assets/index.html-BRngiUtj.js" as="script"><link rel="prefetch" href="/assets/index.html-DwpukPF0.js" as="script"><link rel="prefetch" href="/assets/index.html-CQJZlu3D.js" as="script"><link rel="prefetch" href="/assets/index.html-DvEgBY8L.js" as="script"><link rel="prefetch" href="/assets/index.html-HkBlVWHa.js" as="script"><link rel="prefetch" href="/assets/index.html-Did4chCJ.js" as="script"><link rel="prefetch" href="/assets/flowchart-CTwbLKUk.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-TuuWYy-7.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-DXWKOczD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">doc</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/AI/" aria-label="  AI  "><!--[--><span class="font-icon icon iconfont icon-ai-robot" style=""></span><!--]-->  AI  <!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Java"><!--[--><span class="font-icon icon iconfont icon-java" style=""></span>Java<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">Java开发知识体系</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/base/" aria-label="Java基础语法入门"><!---->Java基础语法入门<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/core/" aria-label="Java进阶及核心特性"><!---->Java进阶及核心特性<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/frame/" aria-label="JavaWeb及常用框架"><!---->JavaWeb及常用框架<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/database/" aria-label="数据库与ORM框架"><!---->数据库与ORM框架<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/java/service/" aria-label="分布式与微服务架构"><!---->分布式与微服务架构<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">Java项目及解决方案</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/project/base/" aria-label="常见工具和环境"><!---->常见工具和环境<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/project/mall/" aria-label="电商项目综合实践"><!---->电商项目综合实践<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/project/solution/" aria-label="项目场景解决方案"><!---->项目场景解决方案<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/java/interview/" aria-label="Java常见面试题分析"><!--[--><span class="font-icon icon iconfont icon-microservice" style=""></span><!--]-->Java常见面试题分析<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Web"><!--[--><span class="font-icon icon iconfont icon-net" style=""></span>Web<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web/base/" aria-label="前端基础知识"><!--[--><span class="font-icon icon iconfont icon-net" style=""></span><!--]-->前端基础知识<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web/core/" aria-label="开发框架和工具"><!--[--><span class="font-icon icon iconfont icon-cloud" style=""></span><!--]-->开发框架和工具<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web/security/" aria-label="性能优化与Web安全"><!--[--><span class="font-icon icon iconfont icon-project" style=""></span><!--]-->性能优化与Web安全<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Python"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span>Python<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/base/" aria-label="开发环境和基础语法"><!--[--><span class="font-icon icon iconfont icon-python" style=""></span><!--]-->开发环境和基础语法<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/frame/" aria-label="常用库和框架"><!--[--><span class="font-icon icon iconfont icon-app" style=""></span><!--]-->常用库和框架<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/image/" aria-label="Python图像处理"><!--[--><span class="font-icon icon iconfont icon-img" style=""></span><!--]-->Python图像处理<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/python/Project/" aria-label="相关项目及应用"><!--[--><span class="font-icon icon iconfont icon-project" style=""></span><!--]-->相关项目及应用<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="C++"><!--[--><span class="font-icon icon iconfont icon-cpp" style=""></span>C++<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cpp/base/" aria-label="C/C++基础语法入门"><!---->C/C++基础语法入门<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/cpp/ed/" aria-label="单片机和嵌入式开发"><!---->单片机和嵌入式开发<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Blog"><!--[--><span class="font-icon icon iconfont icon-blog" style=""></span>Blog<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/blog.html" aria-label="Blog HomePage"><!--[--><span class="font-icon icon iconfont icon-home" style=""></span><!--]-->Blog HomePage<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/blog/" aria-label="导航/日常博客记录"><!---->导航/日常博客记录<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/cs/" aria-label="计算机理论基础"><!---->计算机理论基础<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/java/" aria-label="Java/AI开发相关记录"><!---->Java/AI开发相关记录<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/posts/db/" aria-label="数据库相关博客"><!---->数据库相关博客<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/posts/om/" aria-label="运维基础及环境搭建"><!---->运维基础及环境搭建<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/ventixy/notebook" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><span class="font-icon icon iconfont icon-es6" style=""></span><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/posts/db/" aria-label="Blog-数据库相关博客"><!---->Blog-数据库相关博客<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/mysql.html" aria-label="MySQL数据库"><!---->MySQL数据库<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/mysql-binlog.html" aria-label="Binlog"><!---->Binlog<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/mysql-lock.html" aria-label="MySQL事务和锁监控"><!---->MySQL事务和锁监控<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/posts/db/ulimit.html" aria-label="MySQL5.7内存异常"><!---->MySQL5.7内存异常<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/posts/db/postgres.html" aria-label="PostgreSQL"><!---->PostgreSQL<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->MySQL5.7在compose部署时内存异常Bug</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://www.ventix.top" target="_blank" rel="noopener noreferrer">ventixy</a></span><span property="author" content="ventixy"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2025-05-20T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 11 min</span><meta property="timeRequired" content="PT11M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">Database</span><span class="page-category-item color6 clickable" role="navigation">MySQL</span><!--]--><meta property="articleSection" content="Database,MySQL"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color1 clickable" role="navigation">Database</span><span class="page-tag-item color6 clickable" role="navigation">MySQL</span><span class="page-tag-item color1 clickable" role="navigation">ulimit</span><!--]--><meta property="keywords" content="Database,MySQL,ulimit"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#bug-描述">Bug 描述</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#内存异常原因">内存异常原因</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ulimit与内存">ulimit与内存</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#containerd">containerd</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#内存泄漏bug">内存泄漏BUG</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#内存分配优化">内存分配优化</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#内存分配器">内存分配器</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#升级-mysql-版本">升级 MySQL 版本</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#关键参考信息">关键参考信息</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h3 id="bug-描述" tabindex="-1"><a class="header-anchor" href="#bug-描述"><span>Bug 描述</span></a></h3><p>在使用 <code>Docker Compose（version v2.35.1）</code> 部署 <code>MySQL 5.7</code> 时，发现我16G的内存几乎被耗尽，通过 <code>docker stats</code>命令查看，发现MySQL5.7对应的容器占用了几乎所有的内存。<br> 尝试通过 <code>docker run</code> 来部署结果也一样 (<code>docker version: 28.1.1</code>)</p><p>不死心的我于是通过限制资源，在<code>docker-compose.yml</code>中添加了内存大小限制，内容如下：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    deploy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      resources</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        limits</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">          memory</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">2G</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但接下来问题更离谱了，MySQL5.7对应的容器甚至不能正常启动了，一直不断重启，通过 <code>docker compose logs mysql57</code> 查看日志，内容如下：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql5_7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2025-05-20</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 14:56:41+00:00</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [Note] [Entrypoint]: Entrypoint script </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> MySQL Server 5.7.32-1debian10 started.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql5_7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">2025-05-20</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 14:56:43+00:00</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> [ERROR] [Entrypoint]: mysqld failed </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">while</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> attempting</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> config</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mysql5_7</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">  |     </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">command</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> was:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mysqld</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --verbose</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --help</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看起来似乎是因为配置文件的问题，但实际上并没有那么简单。在不联网搜索的情形下询问过多个大模型均不能给出正确答案，只有 Gemini 2.5 Pro 选中联网搜索时，找到了相关的信息。其实通过普通搜索引擎也能找到答案，不少人都遇到过类似的问题。</p><hr><h3 id="内存异常原因" tabindex="-1"><a class="header-anchor" href="#内存异常原因"><span>内存异常原因</span></a></h3><p>通过GitHub Issue 以及各类技术博客的求索，最终发现解决方法为：调整容器的 <code>ulimit</code> 配置，特别是 <code>nofile</code>（最大打开文件描述符数）限制。</p><p>在 <code>docker-compose.yml</code> 文件中为 MySQL 5.7 服务明确地配置一个合理的 <code>ulimits</code> 值。</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ... 其他配置，如 ports, volumes, environment ...</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    ulimits</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      nproc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">65535</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # 建议的进程数限制</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      nofile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        soft</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">65536</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 建议的nofile软限制</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">        hard</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">65536</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # 建议的nofile硬限制</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # ...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">`ulimit` 配置建议</p><ul><li><code>nofile</code>：软限制 (soft) 和硬限制 (hard) 均建议从 <code>65536</code> 开始尝试。社区中的成功案例表明，此范围通常能有效解决问题。根据具体需求和系统能力，此值可在 20000 至 100000+ 之间调整。关键在于提供一个明确且合理的值，避免继承可能存在问题的系统默认值。</li><li><code>nproc</code>：用户最大进程数限制，通常设置为 <code>65535</code> 已能满足绝大多数应用场景。</li></ul></div><p>然后重新部署：<code>docker compose down -v &amp;&amp; docker compose up -d</code> ，果然一切正常了。</p><p>但是问题来了，为什么呢？ulimit 是什么？有什么用呢？</p><hr><h3 id="ulimit与内存" tabindex="-1"><a class="header-anchor" href="#ulimit与内存"><span><code>ulimit</code>与内存</span></a></h3><p><code>ulimit</code> 常用于控制进程可使用的系统资源。对于数据库服务而言，<code>nofile</code> 参数尤为重要，因为它直接影响到数据库能够管理的并发连接数和打开的文件数量。</p><ul><li><p><strong><code>docker compose</code> 与 <code>docker run</code> 在 <code>ulimit</code> 上的默认行为差异</strong>：<br><code>docker run</code> 命令允许通过 <code>--ulimit</code> 参数直接为单个容器设置 <code>nofile</code> 等限制，例如 <code>--ulimit nofile=65536:65536</code>。如果未显式指定，容器通常会继承 Docker 守护进程的 <code>ulimit</code> 设置<br><code>docker compose</code> 则在其 YAML 配置文件中通过 <code>ulimits</code> 块来为服务定义资源限制。若 <code>docker-compose.yml</code> 文件中没有为 MySQL 服务明确定义 <code>ulimits</code>，容器同样会继承 Docker 守护进程的默认值。</p></li><li><p><strong><mark><code>nofile</code></mark> 值过高的“陷阱”</strong>：<br> GitHub 上著名的 <a href="https://github.com/docker-library/mysql/issues/579" target="_blank" rel="noopener noreferrer">docker-library/mysql#579</a> Issue，揭示了问题的核心：在某些操作系统环境（如 Arch Linux）或特定 Docker 版本下，容器可能继承一个<strong>异常高</strong>的 <code>nofile</code> 默认值（例如，高达 <mjx-container class="MathJax" jax="SVG" style="position:relative;"><svg style="vertical-align:0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewBox="0 -833.9 1290.1 833.9" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mn>30</mn></mrow></msup></math></mjx-assistive-mml></mjx-container>，即 1073741816）。实践表明，MySQL 5.7 在面对如此巨大的 <code>nofile</code> 上限时，其内部的某些内存管理或资源分配机制可能会出现异常，导致内存使用量急剧上升且无法有效释放。</p></li></ul><hr><h3 id="containerd" tabindex="-1"><a class="header-anchor" href="#containerd"><span>containerd</span></a></h3><p>也有人提出该问题与 Docker 底层容器运行时 <code>containerd</code> 的版本更新有密切关联。</p><p>自 <code>containerd</code> 1.5.10 版本左右开始，由于其自身或其依赖的 Go 语言运行时（特别是 Go 1.19+）对 <code>RLIMIT_NOFILE</code>（即 <code>nofile</code> 的底层表示）硬限制的处理方式进行了调整，可能导致容器继承一个非常高的 <code>nofile</code> 硬限制，并且软限制也随之被拉高至与硬限制相同的值。这意味着，即使用户并未主动修改系统或 Docker 的 <code>ulimit</code> 配置，仅仅是 Docker Engine 或 <code>containerd</code> 的一次常规升级，就可能使得先前运行正常的 MySQL 5.7 + Docker Compose 配置因 <code>nofile</code> 值过高而突然出现内存异常。</p><p>相关的深入讨论和问题追踪可见于 <a href="https://github.com/containerd/containerd/issues/6707" target="_blank" rel="noopener noreferrer">containerd/containerd#6707</a> 和 <a href="https://github.com/containerd/containerd/issues/8249" target="_blank" rel="noopener noreferrer">containerd/containerd#8249</a>。</p><hr><h3 id="内存泄漏bug" tabindex="-1"><a class="header-anchor" href="#内存泄漏bug"><span>内存泄漏BUG</span></a></h3><p>虽然调整 <code>ulimit nofile</code> 是解决 MySQL 5.7 在 Docker Compose 中内存异常的关键，但在某些情况下，问题可能是多因素叠加的结果，或者即便 <code>ulimit</code> 配置合理后，仍有进一步优化内存使用的空间。</p><p>MySQL 官方的 BUG 追踪系统也记录了一些与 MySQL 5.7 内存使用相关的已知问题，这些 BUG 可能在特定条件下被触发或加剧：</p><ul><li><strong>(<a href="https://bugs.mysql.com/bug.php?id=83047" target="_blank" rel="noopener noreferrer">https://bugs.mysql.com/bug.php?id=83047</a>)</strong> ：此 BUG 报告描述了 InnoDB 存储引擎在特定工作负载下（如大量写入或大事务）可能出现内存逐渐增长，最终导致服务器因内存耗尽而停止服务的情况。报告中提及，通过切换到 <code>jemalloc</code> 内存分配库可以有效缓解此问题，这间接指向了 MySQL 5.7 默认使用的 glibc 内存分配器可能存在的效率问题或与特定场景的不兼容。</li><li><strong>(<a href="https://bugs.mysql.com/bug.php?id=97935" target="_blank" rel="noopener noreferrer">https://bugs.mysql.com/bug.php?id=97935</a>)</strong> ：该 BUG 指出，当客户端频繁连接和断开，并且在会话中执行了对 <code>information_schema</code> 的查询（包括MySQL内部执行的 <code>SHOW GLOBAL STATUS</code> 命令，因其会查询 <code>information_schema.global_status</code>）时，MySQL 5.7.28 及相近版本会出现内存泄漏。内存分配被追踪到 <code>mysql_socket_vio_new</code> 相关调用栈。由于 <code>information_schema</code> 的实现在 MySQL 8.0 中已被重写，该 BUG 对 5.7 版本被标记为“不会修复 (Won&#39;t fix)”。</li></ul><hr><h3 id="内存分配优化" tabindex="-1"><a class="header-anchor" href="#内存分配优化"><span>内存分配优化</span></a></h3><ol><li>默认内存分配器 (glibc) 的局限性:</li></ol><p>MySQL 5.7 通常依赖操作系统提供的标准 C 库（glibc）中的 ptmalloc 作为其默认内存分配器。然而，在某些高并发、长连接或特定内存分配与释放模式下，glibc ptmalloc 可能会产生<mark>内存碎片</mark>（Memory Fragmentation）。这意味着即使应用逻辑上已经释放了内存，由于碎片的存在，操作系统层面看到的进程常驻内存集合大小 (RSS) 可能依然居高不下，甚至持续增长。</p><ol start="2"><li>Performance Schema 的内存占用</li></ol><p>MySQL Performance Schema 是一个强大的用于监控服务器内部执行细节的工具。但启用 Performance Schema 会消耗额外的内存资源来存储收集到的性能数据、元数据以及内部数据结构。在内存资源受限的 Docker 容器环境中，这部分开销可能变得尤为显著。</p><p><strong>优化建议</strong>：如果对 MySQL 的详细内部性能监控需求不高，或者内存压力较大，可以考虑禁用 Performance Schema。这通常可以通过在 <code>docker-compose.yml</code> 的 <code>command</code> 字段中为 <code>mysqld</code> 添加启动参数 <code>--performance_schema=0</code> 来实现。</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    command</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">mysqld</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">--performance_schema=0</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      # - 其他 mysqld 启动参数可以继续添加在此</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>MySQL 内部配置参数的审视与调优</li></ol><p>合理的 MySQL 内部参数配置对于控制内存占用同样至关重要。以下是一些关键参数：</p><ul><li><code>innodb_buffer_pool_size</code>：这是 InnoDB 存储引擎最重要的内存组件，用于缓存数据和索引。在容器环境中，应根据为容器分配的内存上限来设定此值，一个常见的经验法则是将其设置为容器可用内存的 <strong>50%-70%</strong> 。设置过大可能导致容器 OOM，过小则影响性能。</li><li><code>max_connections</code>：定义了 MySQL 服务器允许的最大并发客户端连接数。每个连接都会消耗服务器的一定内存资源。应根据应用的实际并发量和容器的内存限制来审慎设置此值，避免远超实际需求，默认的 <code>151</code> 可能对某些轻量级应用过高。</li><li><code>query_cache_size</code> 和 <code>query_cache_type</code>：查询缓存在 MySQL 5.7 中已被官方标记为废弃（deprecated），并在 MySQL 8.0 中被彻底移除。在高并发写入场景下，查询缓存很容易成为性能瓶颈，并且其内存管理也可能不够高效。强烈建议在 MySQL 5.7 中将其<strong>彻底禁用</strong> (将 <code>query_cache_size</code> 和 <code>query_cache_type</code> 均设置为 <code>0</code>) 。</li><li>其他参数：如 <code>table_open_cache</code>、<code>table_definition_cache</code>（与打开文件描述符相关）、<code>thread_cache_size</code>、<code>key_buffer_size</code>（若主要使用 InnoDB，可设较小值，如 8M-16M）以及各种会话级缓冲区（如 <code>read_buffer_size</code>, <code>sort_buffer_size</code>, <code>join_buffer_size</code> 等）都应根据实际工作负载和容器资源进行审慎配置，避免不必要的内存浪费。</li></ul><hr><h3 id="内存分配器" tabindex="-1"><a class="header-anchor" href="#内存分配器"><span>内存分配器</span></a></h3><p>高级优化：采用替代内存分配器 (jemalloc / TCMalloc):</p><p>鉴于默认 glibc ptmalloc 可能存在的内存碎片和效率问题，更换为更先进的内存分配器（如 <code>jemalloc</code> 或 Google 的 <code>TCMalloc</code>）是一个有效的进阶优化手段。<code>jemalloc</code> 因其在减少内存碎片和提升高并发环境下内存分配性能方面的优异表现，尤其被广泛推荐用于改善 MySQL 的内存使用效率和稳定性。</p><p><strong>实施方法</strong>：在 Docker 环境中，这通常通过构建一个自定义的 Docker 镜像来实现。以 <code>jemalloc</code> 为例，可以在官方 <code>mysql:5.7</code> 镜像（通常基于 Debian/Ubuntu）的基础上，安装 <code>libjemalloc1</code> 包，然后通过 <code>LD_PRELOAD</code> 环境变量在 MySQL 服务器启动前预加载 <code>jemalloc</code> 的共享库。</p><div class="hint-container important"><p class="hint-container-title">Dockerfile for `mysql:5.7` with `jemalloc`</p><div class="language-dockerfile line-numbers-mode" data-highlighter="shiki" data-ext="dockerfile" data-title="dockerfile" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Dockerfile for mysql:5.7 with jemalloc</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> mysql:5.7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Install jemalloc (libjemalloc1 for Debian/Ubuntu based images)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># The path /usr/lib/x86_64-linux-gnu/libjemalloc.so.1 is common for jemalloc v1 on Debian.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Verify the exact path if issues arise; it might be libjemalloc.so.2 for newer versions of the lib.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> apt-get update &amp;&amp; \</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    apt-get install -y libjemalloc1 &amp;&amp; \</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    rm -rf /var/lib/apt/lists/*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Set LD_PRELOAD to use jemalloc for all processes started by this image&#39;s entrypoint/cmd.</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Ensure the path to libjemalloc.so.1 is correct for the base image.</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libjemalloc.so.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><p>构建此自定义镜像后（例如，<code>docker build -t my-mysql57-jemalloc .</code>），在 <code>docker-compose.yml</code> 文件中将 <code>image</code> 指令指向这个新构建的镜像名即可。</p><hr><h3 id="升级-mysql-版本" tabindex="-1"><a class="header-anchor" href="#升级-mysql-版本"><span>升级 MySQL 版本</span></a></h3><p>如果业务应用的兼容性允许，并且没有特定的历史原因或依赖必须坚守 MySQL 5.7，那么<strong>升级到 MySQL 8.0 或更高版本</strong>通常是解决此类内存问题的最彻底和最具前瞻性的方案。</p><p>目前MySQL 8.0 在相同的 Docker Compose 环境下没有出现类似的内存异常问题。这得益于 MySQL 8.0 在内存管理机制、<code>information_schema</code> 的实现效率、Performance Schema 的默认行为和资源消耗等方面均有显著的改进和重写。例如，前述的 Bug #97935（<code>information_schema</code> 内存泄漏）在 MySQL 8.0 中因该组件的重写而自然解决。</p><hr><h3 id="关键参考信息" tabindex="-1"><a class="header-anchor" href="#关键参考信息"><span>关键参考信息</span></a></h3><p>以下列出与本文讨论内容高度相关的 MySQL 官方 BUG 报告和 GitHub Issue 链接：</p><ul><li><p><strong>MySQL Bugs</strong>:</p><ul><li><a href="https://bugs.mysql.com/bug.php?id=83047" target="_blank" rel="noopener noreferrer">Bug #83047: Memory usage gradually increases and brings server to halt</a> (描述了 InnoDB 内存持续增长问题，并提及 <code>jemalloc</code> 作为缓解方案)</li><li><a href="https://bugs.mysql.com/bug.php?id=97935" target="_blank" rel="noopener noreferrer">Bug #97935: Memory leak in client connection using information_schema</a> (指出了 MySQL 5.7.28 在特定 <code>information_schema</code> 查询下的内存泄漏，该问题在 5.7 版本中不会修复)</li></ul></li><li><p><strong>GitHub Issues (Docker &amp; <code>containerd</code> 相关)</strong>:</p><ul><li><a href="https://github.com/docker-library/mysql/issues/579" target="_blank" rel="noopener noreferrer">docker-library/mysql#579: Really high memory usage</a> (核心讨论区，详细记录了 <code>ulimit nofile</code> 设置过高导致 MySQL 5.7 内存异常的发现过程和解决方案)</li><li><a href="https://github.com/containerd/containerd/issues/6707" target="_blank" rel="noopener noreferrer">containerd/containerd#6707: 1.5.10 causes memory leak in mysql container</a> (指出了 <code>containerd</code> 版本升级（特别是 1.5.10）如何改变了 <code>LimitNOFILE</code> 的默认行为，进而引发了 MySQL 容器的内存问题)</li><li><a href="https://github.com/containerd/containerd/issues/8249" target="_blank" rel="noopener noreferrer">containerd/containerd#8249: RLIMIT_NOFILE soft limit is raised implicitly to hard limit since Go 1.19</a> (深入探讨了 Go 语言版本更新对 <code>containerd</code> 处理 <code>RLIMIT_NOFILE</code> 行为的影响，是理解 <code>nofile</code> 值变化的深层原因)</li><li><a href="https://www.google.com/search?q=https://github.com/containerd/containerd/pull/7566" target="_blank" rel="noopener noreferrer">containerd/containerd#7566: Revert commit that changed LimitNOFILE to infinity to avoid regressions</a> (相关的 Pull Request 和社区关于回退 <code>LimitNOFILE</code> 默认值为 <code>infinity</code> 的讨论)</li><li><a href="https://gist.github.com/vicenterusso/ae6d6c903b790e5dae91c339c1ce2ba8" target="_blank" rel="noopener noreferrer">Gist ae6d6c903b790e5dae91c339c1ce2ba8 by vicenterusso: Docker Compose fix for MySQL memory leak on Fedora</a> (提供了一个具体的 <code>docker-compose.yml</code> 中 <code>ulimits</code> 配置示例，用于解决 Fedora 等系统上的 MySQL 内存泄漏问题)</li><li><a href="https://github.com/cBioPortal/cbioportal/issues/10523" target="_blank" rel="noopener noreferrer">cBioPortal/cbioportal#10523: mySQL memory leak using docker compose on Rocky Linux 9.3</a> (展示了在具体项目中如何通过调整 <code>ulimits</code> 来解决 MySQL 内存泄漏问题)</li><li><a href="https://github.com/lando/lando/issues/3523" target="_blank" rel="noopener noreferrer">lando/lando#3523: Mysql container hogs memory</a> (另一个指向 <code>ulimit</code> 和 <code>containerd</code> 问题的社区案例)</li></ul></li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/ventixy/notebook/edit/main/src/posts/db/ulimit.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: msdrizzle@outlook.com">drizzle</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/posts/db/mysql-lock.html" aria-label="MySQL事务和锁监控"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->MySQL事务和锁监控</div></a><a class="route-link auto-link next" href="/posts/db/postgres.html" aria-label="PostgreSQL"><div class="hint">Next<span class="arrow end"></span></div><div class="link">PostgreSQL<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">Default footer</div><div class="vp-copyright">Copyright © 2025 ventixy </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BZ6c0yG4.js" defer></script>
  </body>
</html>
